增删已定义的聊天室 { .text-center }
---------------

&nbsp;

### 如何使用已定义的聊天室

如前文 [快速入门](#2) 介绍，他人已定义好的聊天室，应该同时预备该聊天室的二维码。在自己的填密语公众号中使用该聊天室，只需对着二维码拍照，把照片发到填密语公号的 GPT 聊天室中，系统即自行添加这个聊天室。向好友推荐聊天室，也只需把对应二维码图片发给他。

如果想删除已添加的聊天室，请在填密语公众号的主页，点 “配置” 按钮，在随后打开的页面中，找到聊天室列表，点击列表中某项 “移除” 链接，就能删除对应的聊天室了。

在填密语公众号中可添加的聊天室有总量限制（当前最多可加 16 个房间），超出限制会导致新聊天室添加不成功，如果遇到这种情况，用户应先行移除不常用的聊天室。

&nbsp;

### 怎样的二维码才能导入为聊天室？

填密语公众号从二维码提取出 URL 后，会尝试出该 URL 拉取聊天室的定义，所以，能导入聊天室的二维码，其 URL 须按官方规定，以特定格式定义聊天室。具体格式要求如下：

其一，用 `<pre><code class="tmy-room">` 与 `</code></pre>` 把聊天室的定义体包含进来。

其二，聊天室定义须严格按 json 格式编写，其中 room_name 属性必须定义，另外，在 magic_rules 与 prompts 字段至少定义一个触发词规则。

最简 room 定义可以像下面样子。

``` html
<pre><code class="tmy-room">
{
  "room_name": "我的聊天室",
  "magic_rules": {"*":["*"]},
  "prompts": {
    "*": {"ask":""}
  }
}
</code></pre>
```

从聊天室二维码所对应 URL 拉取的数据要求以 utf-8 格式编码，其内容可以是 Markdown 格式的文本，也可以是 html 页面。聊天室定义一旦在公众号中使用，公众号后台会自动将它保存至数据库，日常使用时，不再到二维码对应 URL 拉取信息。

&nbsp;

### 在其它聊天室导入二维码

通过二维码导入聊天室定义是 GPT 房间专有的功能，其它聊天室不具备此能力。不过其它聊天室通过配置 `room_cfg.accept_qr_url` 为 true 后，可启用二维码导入的功能，如果导入成功，系统将在该聊天室保存全局变量 `QR_URL`，以便记录从二维码中识别出来的 URL 值。

缺省情况下 `room_cfg.accept_qr_url` 取 false 值，表示二维码导入的功能未启用。设计某聊天室，如果想从某指定网址拉取信息，不妨启用本功能，毕竟在移动设置输入长串 URL 不方便，改上传二维码图片就方便多了。在全局变量 `QR_URL` 被设置后，借助 URL_FETCH 插件就能拉取该 URL 指向的网页内容了。

&nbsp;

### 使用填密语随手记

填密语公众号为所有用户提供一个静态内容托管工具，即 “随手记” 功能，在公众号首页点击 “配置” 按钮进入一个页面，在该页面能找到 “随手记” 栏目。

随手记支持用户在公众号中输入若干文本（建议用 markdown 格式撰写），保存后该文本将自动发布到某个 URL 下，定义聊天室时可以引用该 URL，以便获得源头输入数据。 

如果配置聊天室的 `room_cfg.auto_qr_url` 为 true，聊天时系统将自动检查 `QR_URL` 全局变量是否已赋值，如果未赋值，系统自动将当前用户自己的 “随手记” URL 临时赋给 `QR_URL` 变量。之后该聊天室在实施一问一答时，视需要可从 `QR_URL` 指示网址拉取信息。

缺省情况下，`room_cfg.auto_qr_url` 取 false 值。

多说一句，“随手记” 在保存文本时若将 “公开可访问” 选项钩上，它对应的 URL 还允许在公众号之外，其它任意浏览器中打开。所以，“随手记” 还是一个便利工具，能将手机中的文本方便的传递到其它终端。如果不指定 “公开可访问” 选项，“随手记” 中的内容就只供自己在填密语公众号中使用。
